<!--
Modified and derived from 
<https://code.google.com/apis/ajax/playground/?type=visualization#scatter_chart> which is under an Apache 2.0 License
<http://www.html5rocks.com/en/tutorials/file/dndfiles/#toc-selecting-files-dnd>

Code by the Illinois VLSI CAD teaching staff.
Released under the University of Illinois/NCSA Open Source License  
-->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>

<title>
  Visualize Placement Result for Programming Assignment #3
</title>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load('visualization', '1', {packages: ['corechart']});
</script>

<style>
  #drop_zone{
    border:2px dashed #bbb;
    -moz-border-radius:5px;
    -webkit-border-radius:5px;
    border-radius:5px;
    padding:25px;
    text-align:center;
    font:20pt bold,"Vollkorn";
    color:#bbb
  }
</style>


</head>
<body>
<div id="drop_zone">Drop placement result file here</div>
<div id="visualization" style="width: 700px; height: 700px;"></div>

<script type="text/javascript">

if (window.File && window.FileReader && window.FileList && window.Blob) {
  // Great success! All the File APIs are supported.
} else {
  alert('The File APIs are not fully supported in this browser. Consider using one from http://www.html5rocks.com/en/features/file_access');
}

var edu = {
  illinois: {
    vlsicad: (function() { 
      //////////////////
      // For drag-n-drop
      //////////////////

      var handleFileSelect= function(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        var files = evt.dataTransfer.files; // FileList object.

        // User can drag-n-drop multiple files at once so we pick only the first one.
        // I don't know of a way to prevent drag-n-drop of multiple files at once.

        var netlist = files[0];
        var reader = new FileReader();
        reader.onload = function(event) {
          var rawText = event.target.result;
          var lines = rawText.split("\n"); //TODO: Check if this works on non-Unix platforms

          var data = new google.visualization.DataTable();
          data.addColumn('number', 'X');
          data.addColumn('number', 'Y');

          var lineIndex, rawLine, splitData;
          for(lineIndex = 0; lineIndex < lines.length; lineIndex++) {
            rawLine = lines[lineIndex]; // e.g., 1 xx.xx yy.yyy
            splitData = rawLine.trim().split(/\s+/);
            data.addRow([parseFloat(splitData[1]), parseFloat(splitData[2])]);
          }

          drawVisualization(data);

        };
        reader.readAsText(netlist);
      };

      var handleDragOver = function(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
      };

      ////////////////////
      // For visualization
      ////////////////////

      var drawVisualization = function(data) {
        // Create and draw the visualization.
        var chart = new google.visualization.ScatterChart(document.getElementById('visualization'));
        var options =  {
          title: 'Placer Results',
          hAxis: {title: 'X', minValue: 0, maxValue: 100, gridlines: {count:8}},
          vAxis: {title: 'Y', minValue: 0, maxValue: 100, gridlines: {count:8}},
          legend: 'none',
          pointSize: 1,
          height: 700,
          width: 700,
          tooltip: {trigger: 'none'}
        };
        chart.draw(data, options);
      };

      return {
        handleDragOver: handleDragOver,
        handleFileSelect: handleFileSelect
      };

    })()
  }
};

  // Setup the dnd listeners.
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', edu.illinois.vlsicad.handleDragOver, false);
  dropZone.addEventListener('drop', edu.illinois.vlsicad.handleFileSelect, false);

</script>
</body>
</html>

